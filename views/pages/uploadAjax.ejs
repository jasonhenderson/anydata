<!DOCTYPE html>
<html>
<head>
    <% include ../partials/header.ejs %>
</head>

<body>

<% include ../partials/nav.ejs %>
<div class="container">
    <button class="btn btn-success upload-file">Perform Upload File Test</button>
    <div class="progress">
        <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
            60%
        </div>
    </div>
</div>

<div class="container">
    <button class="btn btn-success upload-form">Perform Upload Form Test</button>
</div>

<script>
    $(function() {
        setProgress(0);

        $('.upload-file').click(function(e) {
            setProgress(0);

            //https://www.sanwebe.com/2012/06/ajax-file-upload-with-php-and-jquery

            var file = $("#fileInput").get(0).files[0];

            console.log(file);

            $.ajax({
                url: "uploadImage.php",
                type: "POST",
                data: file,
                beforeSend: function (request) {
                    request.setRequestHeader("Content-Type", file.type);
                },
                headers: {
                    "X-Filename" : file.name
                },
                processData: false,
                contentType: false,
                cache: false,
                xhr: function(){
                    //upload Progress
                    var xhr = $.ajaxSettings.xhr();
                    if (xhr.upload) {
                        xhr.upload.addEventListener('progress', function(event) {
                            var percent = 0;
                            var position = event.loaded || event.position;
                            var total = event.total;
                            if (event.lengthComputable) {
                                percent = Math.ceil(position / total * 100);
                            }
                            //update progressbar
                            setProgress(percent);
                        }, true);
                    }
                    return xhr;
                }
            }).done(function(data) {
                console.log('succeeded upload');
                console.log(data);
            }).fail(function(xhr) {
                console.log('failed upload');
                console.log(xhr);
            }).always(function() {
                console.log('done processing upload');
            });
        });

        $('.upload-form').click(function(e) {
            setProgress(0);

            //var formData = new FormData($('form')[0]);
            var data = {
              "message" : "got it!"
            };

            $.ajax({
                url: "data/testing/1.json",
                type: "POST",
                data: JSON.stringify(data),
                dataType: "text",
                contentType: "application/json",
            }).done(function(data) {
                console.log('succeeded upload');
                console.log(data);
            }).fail(function(xhr) {
                console.log('failed upload');
                console.log(xhr);
            }).always(function() {
                console.log('done processing upload');
            });
        });

        function setProgress(percent) {
            $(".progress-bar").css("width", + percent +"%");
            $(".progress-bar").text(percent +"%");
        }
    });
</script>

</body>
</html>
